<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genius - Complete Your Profile</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/icon-512.png">
    
    <!-- Vercel Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script>
        // Only load Vercel Analytics on Vercel deployment
        if (window.location.hostname.includes('vercel.app') || window.location.hostname.includes('vercel.com') || window.location.hostname.includes('genius-site.com')) {
            const script = document.createElement('script');
            script.src = '/_vercel/insights/script.js';
            script.defer = true;
            document.head.appendChild(script);
        }
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #000000, #1a1a1a);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .onboarding-container {
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 10px;
            background-image: url('assets/darkgenius.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text {
            font-size: 32px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 700;
        }

        .subtitle {
            color: #cccccc;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #ffffff, #cccccc);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-container {
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .question {
            color: #ffffff;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .form-group {
            margin-bottom: 30px;
            text-align: left;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 15px 80px 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.03);
            color: #ffffff;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        input[type="text"]::placeholder {
            color: #888888;
        }

        .autocomplete-container {
            position: relative;
            width: 100%;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
        }

        .autocomplete-suggestion {
            padding: 12px 20px;
            cursor: pointer;
            color: #ffffff;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background-color 0.2s ease;
        }

        .autocomplete-suggestion:hover,
        .autocomplete-suggestion.highlighted {
            background: rgba(255, 255, 255, 0.1);
        }

        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }

        .ghost-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 80px;
            bottom: 0;
            padding: 15px 20px;
            color: rgba(255, 255, 255, 0.3);
            pointer-events: none;
            font-size: 16px;
            border: 1px solid transparent;
            border-radius: 8px;
            background: transparent;
            z-index: 1;
        }

        .search-indicator {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.4);
            font-size: 10px;
            pointer-events: none;
            z-index: 3;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .ai-powered {
            color: #4a9eff;
        }

        .api-powered {
            color: #00d4aa;
        }

        select option {
            background: #1a1a1a;
            color: #ffffff;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #333333, #555555);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #ffffff;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            color: #ff6b6b;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid rgba(244, 67, 54, 0.2);
        }

        .success-message {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .step-counter {
            color: #888888;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .navigation-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .navigation-buttons .btn {
            flex: 1;
            margin-bottom: 0;
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="onboarding-container">
        <div class="logo"></div>
        <div class="logo-text">Genius</div>
        <h1>Complete Your Profile</h1>
        <p class="subtitle">Let's set up your Genius account</p>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="step-counter">
            <span id="currentStep">1</span> of <span id="totalSteps">4</span>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;"></div>
        <div id="successMessage" class="success-message" style="display: none;"></div>

        <div class="question-container">
            <!-- Question 1: Full Name -->
            <div id="question1" class="question-container">
                <div class="question">What's your full name?</div>
                <div class="form-group">
                    <input type="text" id="fullName" required>
                </div>
            </div>

            <!-- Question 2: College -->
            <div id="question2" class="question-container hidden">
                <div class="question">Which college or university do you attend?</div>
                <div class="form-group">
                    <div class="autocomplete-container">
                        <input type="text" id="collegeName" required>
                        <div class="ghost-text" id="ghostText"></div>
                        <div class="search-indicator" id="searchIndicator"></div>
                        <div class="autocomplete-suggestions" id="suggestions"></div>
                    </div>
                </div>
            </div>

            <!-- Question 3: Major -->
            <div id="question3" class="question-container hidden">
                <div class="question">What's your major or field of study?</div>
                <div class="form-group">
                    <input type="text" id="major" required>
                </div>
            </div>

            <!-- Question 4: Academic Level -->
            <div id="question4" class="question-container hidden">
                <div class="question">What's your current academic level?</div>
                <div class="form-group">
                    <select id="academicLevel" required>
                        <option value="">Select your level</option>
                        <option value="undergraduate">Undergraduate</option>
                        <option value="graduate">Graduate</option>
                        <option value="phd">PhD</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="navigation-buttons">
            <button class="btn btn-secondary" id="backBtn" style="display: none;">Back</button>
            <button class="btn btn-primary" id="nextBtn">Next</button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Setting up your account...</p>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB-JPtkbuIES5T_m7nkX0Ic1iO_lz0FbTk",
            authDomain: "genius-b5656.firebaseapp.com",
            projectId: "genius-b5656",
            storageBucket: "genius-b5656.firebasestorage.app",
            messagingSenderId: "567988128391",
            appId: "1:567988128391:web:8a48294d736ec4013f8622",
            measurementId: "G-3SEG2XJQMP"
        };

        // Initialize Firebase
        let app, auth, db;
        let currentUser = null;
        let currentStep = 1;
        const totalSteps = 4;
        
        function initFirebase() {
            try {
                app = window.firebase.initializeApp(firebaseConfig);
                auth = window.firebase.auth();
                db = window.firebase.firestore();
                
                console.log('Firebase initialized successfully');
                return true;
            } catch (error) {
                console.error('Firebase initialization error:', error);
                showError('Failed to initialize authentication. Please refresh the page.');
                return false;
            }
        }

        // UI Helper functions
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            successDiv.style.display = 'none';
        }

        function showSuccess(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            errorDiv.style.display = 'none';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        function setLoading(loading) {
            const loadingDiv = document.getElementById('loading');
            const nextBtn = document.getElementById('nextBtn');
            const backBtn = document.getElementById('backBtn');
            
            if (loading) {
                loadingDiv.style.display = 'block';
                nextBtn.disabled = true;
                backBtn.disabled = true;
            } else {
                loadingDiv.style.display = 'none';
                nextBtn.disabled = false;
                backBtn.disabled = false;
            }
        }

        // Check if user has already completed onboarding
        async function checkOnboardingStatus(user) {
            try {
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    console.log('User has already completed onboarding, redirecting to dashboard');
                    window.location.href = 'dashboard.html';
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error checking onboarding status:', error);
                return false;
            }
        }

        // Update progress bar
        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progress = (currentStep / totalSteps) * 100;
            progressFill.style.width = progress + '%';
            
            document.getElementById('currentStep').textContent = currentStep;
            document.getElementById('totalSteps').textContent = totalSteps;
        }

        // Show current question
        function showQuestion(step) {
            // Hide all questions
            for (let i = 1; i <= totalSteps; i++) {
                const question = document.getElementById(`question${i}`);
                question.classList.add('hidden');
            }
            
            // Show current question
            const currentQuestion = document.getElementById(`question${step}`);
            currentQuestion.classList.remove('hidden');
            currentQuestion.classList.add('fade-in');
            
            // Update navigation buttons
            const backBtn = document.getElementById('backBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (step === 1) {
                backBtn.style.display = 'none';
                nextBtn.textContent = 'Next';
            } else if (step === totalSteps) {
                backBtn.style.display = 'flex';
                nextBtn.textContent = 'Complete';
            } else {
                backBtn.style.display = 'flex';
                nextBtn.textContent = 'Next';
            }
            
            updateProgress();
        }

        // Validate current step
        function validateCurrentStep() {
            switch (currentStep) {
                case 1:
                    const fullName = document.getElementById('fullName').value.trim();
                    return fullName.length > 0;
                case 2:
                    const collegeName = document.getElementById('collegeName').value.trim();
                    return collegeName.length > 0;
                case 3:
                    const major = document.getElementById('major').value.trim();
                    return major.length > 0;
                case 4:
                    const academicLevel = document.getElementById('academicLevel').value;
                    return academicLevel.length > 0;
                default:
                    return false;
            }
        }

        // Get current step value
        function getCurrentStepValue() {
            switch (currentStep) {
                case 1:
                    return document.getElementById('fullName').value.trim();
                case 2:
                    return document.getElementById('collegeName').value.trim();
                case 3:
                    return document.getElementById('major').value.trim();
                case 4:
                    return document.getElementById('academicLevel').value;
                default:
                    return '';
            }
        }

        // Save user profile to Firestore
        async function saveUserProfile() {
            try {
                const userData = {
                    name: document.getElementById('fullName').value.trim(),
                    collegeName: document.getElementById('collegeName').value.trim(),
                    major: document.getElementById('major').value.trim(),
                    academicLevel: document.getElementById('academicLevel').value,
                    email: currentUser.email,
                    uid: currentUser.uid,
                    createdAt: new Date(),
                    updatedAt: new Date()
                };

                await db.collection('users').doc(currentUser.uid).set(userData);
                
                // Also save to localStorage for immediate access
                localStorage.setItem('userData', JSON.stringify(userData));
                localStorage.setItem('currentUser', JSON.stringify(userData));
                
                console.log('User profile saved successfully');
                return true;
            } catch (error) {
                console.error('Error saving user profile:', error);
                throw error;
            }
        }

        // Handle next/complete button
        async function handleNext() {
            hideMessages();
            
            if (!validateCurrentStep()) {
                showError('Please fill in the required field');
                return;
            }

            if (currentStep < totalSteps) {
                currentStep++;
                showQuestion(currentStep);
            } else {
                // Complete onboarding
                setLoading(true);
                try {
                    await saveUserProfile();
                    showSuccess('Profile completed successfully! Redirecting to dashboard...');
                    
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                } catch (error) {
                    showError('Failed to save profile. Please try again.');
                    setLoading(false);
                }
            }
        }

        // Handle back button
        function handleBack() {
            if (currentStep > 1) {
                currentStep--;
                showQuestion(currentStep);
            }
        }

        // Event listeners
        document.getElementById('nextBtn').addEventListener('click', handleNext);
        document.getElementById('backBtn').addEventListener('click', handleBack);

        // Allow Enter key to proceed
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleNext();
            }
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Onboarding page loaded');
            
            if (!initFirebase()) {
                return;
            }

            // Check if user is authenticated
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    console.log('User authenticated:', user.uid);
                    
                    // Check if user has already completed onboarding
                    const hasCompleted = await checkOnboardingStatus(user);
                    if (!hasCompleted) {
                        // Show first question
                        showQuestion(1);
                    }
                } else {
                    console.log('No user authenticated, redirecting to login');
                    // Only redirect if we're not already on the login page
                    if (!window.location.pathname.includes('login.html')) {
                        window.location.href = 'login.html';
                    }
                }
            });
        });

        // University autocomplete functionality with API integration
        let universities = [
            // Ivy League
            'Harvard University', 'Yale University', 'Princeton University', 'Columbia University',
            'University of Pennsylvania', 'Dartmouth College', 'Brown University', 'Cornell University',
            
            // Top Private Universities
            'Stanford University', 'Massachusetts Institute of Technology', 'California Institute of Technology',
            'University of Chicago', 'Duke University', 'Northwestern University', 'Johns Hopkins University',
            'Rice University', 'Vanderbilt University', 'Washington University in St. Louis', 'University of Notre Dame',
            'Georgetown University', 'Carnegie Mellon University', 'Emory University', 'New York University',
            'University of Southern California', 'Tufts University', 'Wake Forest University', 'University of Rochester',
            'Boston College', 'Tulane University', 'University of Miami', 'Case Western Reserve University',
            'Northeastern University', 'Boston University', 'Brandeis University', 'Lehigh University',
            'Villanova University', 'University of Richmond', 'William & Mary', 'Washington and Lee University',
            'Colgate University', 'Hamilton College', 'Middlebury College', 'Amherst College',
            'Williams College', 'Swarthmore College', 'Pomona College', 'Claremont McKenna College',
            'Harvey Mudd College', 'Scripps College', 'Pitzer College', 'Wellesley College',
            'Smith College', 'Mount Holyoke College', 'Bryn Mawr College', 'Barnard College',
            'Vassar College', 'Wesleyan University', 'Trinity College', 'Connecticut College',
            'Bates College', 'Bowdoin College', 'Colby College', 'Dartmouth College',
            
            // University of California System
            'University of California, Berkeley', 'University of California, Los Angeles',
            'University of California, San Diego', 'University of California, Santa Barbara',
            'University of California, Irvine', 'University of California, Davis',
            'University of California, Santa Cruz', 'University of California, Riverside',
            'University of California, Merced', 'University of California, San Francisco',
            
            // California State Universities
            'California State University, Long Beach', 'California State University, Fullerton',
            'California State University, Northridge', 'California State University, San Diego',
            'California State University, San Francisco', 'California State University, Los Angeles',
            'California State University, Sacramento', 'California State University, Fresno',
            'California State University, San Jose', 'California State University, Chico',
            'California State University, Humboldt', 'California State University, Monterey Bay',
            'California State University, Stanislaus', 'California State University, East Bay',
            'California State University, Dominguez Hills', 'California State University, Bakersfield',
            'California State University, San Bernardino', 'California State University, Channel Islands',
            'California State University, Maritime Academy', 'California Polytechnic State University',
            'California State Polytechnic University, Pomona', 'San Diego State University',
            'San Francisco State University', 'San Jose State University', 'Cal State LA',
            'Cal State Fullerton', 'Cal State Long Beach', 'Cal State Northridge',
            
            // Private California Universities
            'University of Southern California', 'Stanford University', 'California Institute of Technology',
            'Pepperdine University', 'Loyola Marymount University', 'University of San Diego',
            'University of San Francisco', 'Santa Clara University', 'Chapman University',
            'Occidental College', 'Pitzer College', 'Claremont McKenna College',
            'Harvey Mudd College', 'Scripps College', 'Pomona College',
            
            // University of Texas System
            'University of Texas at Austin', 'University of Texas at Dallas', 'University of Texas at Arlington',
            'University of Texas at San Antonio', 'University of Texas at El Paso', 'University of Texas at Tyler',
            'University of Texas at Permian Basin', 'University of Texas at Rio Grande Valley',
            'University of Texas at Brownsville', 'University of Texas at Pan American',
            'University of Texas Medical Branch', 'University of Texas Health Science Center',
            
            // Texas A&M System
            'Texas A&M University', 'Texas A&M University at Galveston', 'Texas A&M University at Qatar',
            'Texas A&M University at Kingsville', 'Texas A&M University at Corpus Christi',
            'Texas A&M University at Commerce', 'Texas A&M University at Texarkana',
            'Texas A&M University at San Antonio', 'Texas A&M University at Central Texas',
            
            // Other Texas Universities
            'Rice University', 'Baylor University', 'Southern Methodist University',
            'Texas Christian University', 'University of Houston', 'Texas Tech University',
            'University of North Texas', 'Sam Houston State University', 'Stephen F. Austin State University',
            'Texas State University', 'University of Texas Rio Grande Valley',
            
            // Florida Universities
            'University of Florida', 'Florida State University', 'University of Miami',
            'University of Central Florida', 'Florida International University', 'Florida Atlantic University',
            'University of South Florida', 'Florida Institute of Technology', 'Nova Southeastern University',
            'Florida A&M University', 'Florida Gulf Coast University', 'University of West Florida',
            'Florida Polytechnic University', 'New College of Florida',
            
            // New York Universities
            'Columbia University', 'Cornell University', 'New York University', 'University of Rochester',
            'Rensselaer Polytechnic Institute', 'Syracuse University', 'Fordham University',
            'Stony Brook University', 'University at Buffalo', 'Binghamton University',
            'University at Albany', 'CUNY City College', 'CUNY Hunter College', 'CUNY Brooklyn College',
            'CUNY Queens College', 'CUNY Baruch College', 'CUNY Lehman College', 'CUNY John Jay College',
            'CUNY York College', 'CUNY Medgar Evers College', 'CUNY College of Staten Island',
            'CUNY Graduate Center', 'CUNY School of Law', 'CUNY School of Medicine',
            
            // Massachusetts Universities
            'Harvard University', 'Massachusetts Institute of Technology', 'Boston University',
            'Boston College', 'Northeastern University', 'Tufts University', 'Brandeis University',
            'University of Massachusetts Amherst', 'University of Massachusetts Boston',
            'University of Massachusetts Dartmouth', 'University of Massachusetts Lowell',
            'University of Massachusetts Medical School', 'Worcester Polytechnic Institute',
            'Clark University', 'Bentley University', 'Babson College', 'Emerson College',
            'Berklee College of Music', 'New England Conservatory', 'Massachusetts College of Art and Design',
            
            // Illinois Universities
            'University of Chicago', 'Northwestern University', 'University of Illinois at Urbana-Champaign',
            'University of Illinois at Chicago', 'University of Illinois at Springfield',
            'Illinois Institute of Technology', 'DePaul University', 'Loyola University Chicago',
            'Rush University', 'Roosevelt University', 'Columbia College Chicago',
            'School of the Art Institute of Chicago', 'Illinois State University',
            'Northern Illinois University', 'Southern Illinois University Carbondale',
            'Southern Illinois University Edwardsville', 'Western Illinois University',
            'Eastern Illinois University', 'Governors State University', 'Northeastern Illinois University',
            
            // Pennsylvania Universities
            'University of Pennsylvania', 'Carnegie Mellon University', 'Pennsylvania State University',
            'University of Pittsburgh', 'Temple University', 'Drexel University', 'Villanova University',
            'Lehigh University', 'Bucknell University', 'Lafayette College', 'Haverford College',
            'Swarthmore College', 'Bryn Mawr College', 'Dickinson College', 'Franklin & Marshall College',
            'Gettysburg College', 'Juniata College', 'Muhlenberg College', 'Susquehanna University',
            'University of Scranton', 'Villanova University', 'West Chester University',
            'Indiana University of Pennsylvania', 'Kutztown University', 'Millersville University',
            'Shippensburg University', 'Slippery Rock University', 'Bloomsburg University',
            
            // Ohio Universities
            'Ohio State University', 'Case Western Reserve University', 'University of Cincinnati',
            'Ohio University', 'Miami University', 'Bowling Green State University', 'Kent State University',
            'Wright State University', 'University of Akron', 'Cleveland State University',
            'Youngstown State University', 'Oberlin College', 'Kenyon College', 'Denison University',
            'College of Wooster', 'Wittenberg University', 'Ohio Wesleyan University',
            'Antioch College', 'Cedarville University', 'Malone University',
            
            // Michigan Universities
            'University of Michigan', 'Michigan State University', 'Wayne State University',
            'Western Michigan University', 'Central Michigan University', 'Eastern Michigan University',
            'Northern Michigan University', 'Ferris State University', 'Grand Valley State University',
            'Oakland University', 'Saginaw Valley State University', 'University of Michigan-Dearborn',
            'University of Michigan-Flint', 'Michigan Technological University',
            'Kalamazoo College', 'Albion College', 'Alma College', 'Calvin University',
            'Hope College', 'Hillsdale College', 'Kettering University',
            
            // Georgia Universities
            'Georgia Institute of Technology', 'University of Georgia', 'Emory University',
            'Georgia State University', 'Georgia Southern University', 'Kennesaw State University',
            'University of West Georgia', 'Valdosta State University', 'Columbus State University',
            'Georgia College & State University', 'Mercer University', 'Berry College',
            'Agnes Scott College', 'Spelman College', 'Morehouse College', 'Clark Atlanta University',
            
            // North Carolina Universities
            'Duke University', 'University of North Carolina at Chapel Hill', 'North Carolina State University',
            'Wake Forest University', 'University of North Carolina at Charlotte', 'University of North Carolina at Greensboro',
            'University of North Carolina at Wilmington', 'East Carolina University', 'Appalachian State University',
            'Western Carolina University', 'North Carolina A&T State University', 'Davidson College',
            'Elon University', 'High Point University', 'Meredith College', 'Salem College',
            
            // Virginia Universities
            'University of Virginia', 'Virginia Tech', 'College of William & Mary', 'Virginia Commonwealth University',
            'George Mason University', 'Old Dominion University', 'James Madison University',
            'University of Richmond', 'Washington and Lee University', 'Hampden-Sydney College',
            'Randolph-Macon College', 'Hollins University', 'Sweet Briar College',
            'Virginia Military Institute', 'Norfolk State University', 'Virginia State University',
            
            // Washington Universities
            'University of Washington', 'Washington State University', 'Gonzaga University',
            'Seattle University', 'Pacific Lutheran University', 'University of Puget Sound',
            'Whitman College', 'Whitworth University', 'Western Washington University',
            'Central Washington University', 'Eastern Washington University', 'Evergreen State College',
            
            // Oregon Universities
            'University of Oregon', 'Oregon State University', 'Portland State University',
            'Lewis & Clark College', 'Reed College', 'Willamette University', 'University of Portland',
            'Pacific University', 'Linfield College', 'George Fox University',
            'Southern Oregon University', 'Eastern Oregon University', 'Western Oregon University',
            
            // Colorado Universities
            'University of Colorado Boulder', 'Colorado State University', 'University of Denver',
            'Colorado School of Mines', 'University of Colorado Denver', 'University of Northern Colorado',
            'Colorado College', 'Fort Lewis College', 'Mesa State University',
            'Adams State University', 'Western State Colorado University', 'Regis University',
            
            // Arizona Universities
            'University of Arizona', 'Arizona State University', 'Northern Arizona University',
            'Grand Canyon University', 'University of Phoenix', 'Prescott College',
            
            // Utah Universities
            'University of Utah', 'Brigham Young University', 'Utah State University',
            'Weber State University', 'Southern Utah University', 'Westminster College',
            'Utah Valley University', 'Dixie State University',
            
            // Nevada Universities
            'University of Nevada, Las Vegas', 'University of Nevada, Reno', 'Nevada State College',
            
            // New Mexico Universities
            'University of New Mexico', 'New Mexico State University', 'New Mexico Institute of Mining and Technology',
            
            // Montana Universities
            'University of Montana', 'Montana State University', 'Montana Tech',
            
            // Wyoming Universities
            'University of Wyoming', 'Casper College', 'Laramie County Community College',
            
            // Idaho Universities
            'University of Idaho', 'Boise State University', 'Idaho State University',
            'Lewis-Clark State College', 'College of Idaho',
            
            // Alaska Universities
            'University of Alaska Anchorage', 'University of Alaska Fairbanks', 'University of Alaska Southeast',
            
            // Hawaii Universities
            'University of Hawaii at Manoa', 'University of Hawaii at Hilo', 'Hawaii Pacific University',
            'Brigham Young University Hawaii', 'Chaminade University of Honolulu',
            
            // Arkansas Universities
            'University of Arkansas', 'Arkansas State University', 'University of Central Arkansas',
            'Hendrix College', 'Ouachita Baptist University',
            
            // Louisiana Universities
            'Louisiana State University', 'Tulane University', 'University of Louisiana at Lafayette',
            'University of New Orleans', 'Loyola University New Orleans', 'Xavier University of Louisiana',
            'Dillard University', 'Southern University', 'Grambling State University',
            
            // Mississippi Universities
            'University of Mississippi', 'Mississippi State University', 'Jackson State University',
            'Millsaps College', 'Belhaven University',
            
            // Alabama Universities
            'University of Alabama', 'Auburn University', 'University of Alabama at Birmingham',
            'Samford University', 'Troy University', 'University of South Alabama',
            'Alabama State University', 'Alabama A&M University',
            
            // Tennessee Universities
            'Vanderbilt University', 'University of Tennessee', 'Rhodes College',
            'Sewanee: The University of the South', 'Middle Tennessee State University',
            'Tennessee State University', 'Austin Peay State University',
            
            // Kentucky Universities
            'University of Kentucky', 'University of Louisville', 'Berea College',
            'Centre College', 'Transylvania University', 'Western Kentucky University',
            
            // West Virginia Universities
            'West Virginia University', 'Marshall University', 'Shepherd University',
            'West Virginia State University', 'Fairmont State University',
            
            // Delaware Universities
            'University of Delaware', 'Delaware State University', 'Wesley College',
            
            // Maryland Universities
            'Johns Hopkins University', 'University of Maryland', 'University of Maryland, Baltimore County',
            'Towson University', 'Salisbury University', 'Frostburg State University',
            'Morgan State University', 'St. Mary\'s College of Maryland',
            
            // New Jersey Universities
            'Princeton University', 'Rutgers University', 'Stevens Institute of Technology',
            'New Jersey Institute of Technology', 'Seton Hall University', 'Rider University',
            'Monmouth University', 'Drew University', 'Ramapo College', 'The College of New Jersey',
            
            // Connecticut Universities
            'Yale University', 'University of Connecticut', 'Wesleyan University',
            'Trinity College', 'Connecticut College', 'Fairfield University',
            'Quinnipiac University', 'Sacred Heart University', 'University of New Haven',
            
            // Rhode Island Universities
            'Brown University', 'University of Rhode Island', 'Providence College',
            'Rhode Island School of Design', 'Bryant University', 'Roger Williams University',
            
            // Vermont Universities
            'University of Vermont', 'Middlebury College', 'Bennington College',
            'St. Michael\'s College', 'Champlain College', 'Norwich University',
            
            // New Hampshire Universities
            'Dartmouth College', 'University of New Hampshire', 'Keene State College',
            'Plymouth State University', 'Franklin Pierce University', 'Southern New Hampshire University',
            
            // Maine Universities
            'Bowdoin College', 'Colby College', 'Bates College', 'University of Maine',
            'University of Southern Maine', 'Maine Maritime Academy', 'Thomas College',
            
            // Minnesota Universities
            'University of Minnesota', 'Carleton College', 'Macalester College',
            'St. Olaf College', 'Gustavus Adolphus College', 'College of St. Benedict',
            'St. John\'s University', 'Hamline University', 'Augsburg University',
            
            // Wisconsin Universities
            'University of Wisconsin-Madison', 'Marquette University', 'Lawrence University',
            'Beloit College', 'Ripon College', 'St. Norbert College', 'Carthage College',
            'University of Wisconsin-Milwaukee', 'University of Wisconsin-La Crosse',
            
            // Iowa Universities
            'University of Iowa', 'Iowa State University', 'Grinnell College',
            'Drake University', 'Luther College', 'Coe College', 'Cornell College',
            'University of Northern Iowa', 'Simpson College',
            
            // Missouri Universities
            'Washington University in St. Louis', 'University of Missouri', 'Saint Louis University',
            'Missouri University of Science and Technology', 'Truman State University',
            'University of Missouri-Kansas City', 'Missouri State University',
            
            // Kansas Universities
            'University of Kansas', 'Kansas State University', 'Washburn University',
            'Emporia State University', 'Pittsburg State University', 'Fort Hays State University',
            
            // Nebraska Universities
            'University of Nebraska-Lincoln', 'Creighton University', 'University of Nebraska at Omaha',
            'University of Nebraska at Kearney', 'Chadron State College', 'Wayne State College',
            
            // South Dakota Universities
            'University of South Dakota', 'South Dakota State University', 'Augustana University',
            'Dakota State University', 'Northern State University', 'Black Hills State University',
            
            // North Dakota Universities
            'University of North Dakota', 'North Dakota State University', 'Minot State University',
            'Dickinson State University', 'Valley City State University', 'Mayville State University',
            
            // Oklahoma Universities
            'University of Oklahoma', 'Oklahoma State University', 'University of Tulsa',
            'Oklahoma City University', 'Oral Roberts University', 'Northeastern State University',
            
            // Community Colleges and Technical Schools
            'Miami Dade College', 'Broward College', 'Valencia College', 'Santa Monica College',
            'Pasadena City College', 'De Anza College', 'Foothill College', 'Diablo Valley College',
            'Los Angeles Pierce College', 'Los Angeles Valley College', 'Orange Coast College',
            'Saddleback College', 'Cypress College', 'Fullerton College', 'Golden West College',
            'Irvine Valley College', 'Santiago Canyon College', 'Coastline Community College',
            'Golden West College', 'Orange Coast College', 'Saddleback College',
            
            // International Universities (Major ones)
            'University of Oxford', 'University of Cambridge', 'Imperial College London',
            'London School of Economics', 'University College London', 'King\'s College London',
            'University of Edinburgh', 'University of Glasgow', 'University of St Andrews',
            'University of Manchester', 'University of Birmingham', 'University of Leeds',
            'University of Sheffield', 'University of Liverpool', 'University of Bristol',
            'University of Nottingham', 'University of Southampton', 'University of Warwick',
            'University of York', 'University of Durham', 'University of Exeter',
            'University of Bath', 'University of Surrey', 'University of Sussex',
            'Lancaster University', 'University of Reading', 'University of Kent',
            'University of Essex', 'University of East Anglia', 'University of Leicester',
            'University of Hull', 'University of Bradford', 'University of Huddersfield',
            'University of Salford', 'Manchester Metropolitan University', 'University of Central Lancashire',
            'Sheffield Hallam University', 'Leeds Beckett University', 'Liverpool John Moores University',
            'University of Brighton', 'University of Portsmouth', 'University of Plymouth',
            'University of the West of England', 'University of Gloucestershire', 'University of Worcester',
            'University of Chester', 'University of Cumbria', 'University of Derby',
            'University of Lincoln', 'University of Northampton', 'University of Sunderland',
            'Teesside University', 'University of Wolverhampton', 'University of Worcester',
            'York St John University', 'Leeds Trinity University', 'University of Chichester',
            'Canterbury Christ Church University', 'University of Greenwich', 'University of East London',
            'London Metropolitan University', 'Middlesex University', 'University of West London',
            'Kingston University', 'Roehampton University', 'University of the Arts London',
            'Goldsmiths, University of London', 'Birkbeck, University of London', 'SOAS University of London',
            'Royal Holloway, University of London', 'Queen Mary University of London',
            'St George\'s, University of London', 'City, University of London',
            'University of the West of Scotland', 'University of Strathclyde', 'University of Stirling',
            'University of Aberdeen', 'University of Dundee', 'University of Abertay Dundee',
            'Edinburgh Napier University', 'Glasgow Caledonian University', 'Heriot-Watt University',
            'Queen Margaret University', 'Robert Gordon University', 'University of the Highlands and Islands',
            'Cardiff University', 'Swansea University', 'Bangor University', 'Aberystwyth University',
            'University of South Wales', 'Cardiff Metropolitan University', 'University of Wales Trinity Saint David',
            'Wrexham Glyndwr University', 'University of Ulster', 'Queen\'s University Belfast',
            'Ulster University', 'Stranmillis University College', 'St Mary\'s University College',
            'Trinity College Dublin', 'University College Dublin', 'National University of Ireland, Galway',
            'University College Cork', 'Dublin City University', 'University of Limerick',
            'Maynooth University', 'Technological University Dublin', 'Athlone Institute of Technology',
            'Cork Institute of Technology', 'Dundalk Institute of Technology', 'Galway-Mayo Institute of Technology',
            'Institute of Technology, Carlow', 'Institute of Technology, Sligo', 'Institute of Technology, Tallaght',
            'Institute of Technology, Tralee', 'Letterkenny Institute of Technology', 'Limerick Institute of Technology',
            'Waterford Institute of Technology', 'Dublin Institute of Technology',
            'University of Toronto', 'University of British Columbia', 'McGill University',
            'McMaster University', 'University of Alberta', 'University of Waterloo',
            'Western University', 'Queen\'s University', 'University of Calgary',
            'Simon Fraser University', 'University of Ottawa', 'Dalhousie University',
            'University of Montreal', 'Concordia University', 'Laval University',
            'University of Sherbrooke', 'Carleton University', 'University of Victoria',
            'York University', 'Ryerson University', 'University of Guelph',
            'University of Saskatchewan', 'Memorial University of Newfoundland', 'University of New Brunswick',
            'Acadia University', 'Mount Allison University', 'St. Francis Xavier University',
            'University of Prince Edward Island', 'Bishop\'s University', 'Trent University',
            'Lakehead University', 'Laurentian University', 'Nipissing University',
            'University of Northern British Columbia', 'Thompson Rivers University',
            'University of the Fraser Valley', 'Kwantlen Polytechnic University', 'Capilano University',
            'Vancouver Island University', 'University of Northern British Columbia',
            'University of Lethbridge', 'Mount Royal University', 'University of Regina',
            'Brandon University', 'University of Winnipeg', 'University of Manitoba',
            'University of New Brunswick', 'Mount Allison University', 'St. Thomas University',
            'Universit de Moncton', 'Cape Breton University', 'Nova Scotia College of Art and Design',
            'Mount Saint Vincent University', 'Saint Mary\'s University', 'St. Francis Xavier University',
            'Acadia University', 'Dalhousie University', 'University of King\'s College',
            'NSCAD University', 'Universit Sainte-Anne', 'Atlantic School of Theology',
            'Canadian Coast Guard College', 'Nova Scotia Community College', 'Collge de l\'le',
            'Holland College', 'University of Prince Edward Island', 'Collge de l\'Acadie',
            'Collge de l\'Atlantique', 'Collge de l\'le-du-Prince-douard',
            'Universit de l\'le-du-Prince-douard', 'Collge de l\'Acadie', 'Holland College',
            'University of Prince Edward Island', 'Collge de l\'Acadie', 'Holland College',
            'University of Prince Edward Island', 'Collge de l\'Acadie', 'Holland College'
        ];

        let currentSuggestions = [];
        let selectedIndex = -1;
        let ghostText = '';
        let apiCache = new Map();
        let isApiEnabled = false;

        // Initialize API-based college search
        async function initializeCollegeAPI() {
            try {
                // Check if we have an OpenAI API key for AI-powered search
                const apiKey = window.getOpenAIApiKey ? window.getOpenAIApiKey() : null;
                if (apiKey) {
                    isApiEnabled = true;
                    console.log(' AI-powered college search enabled');
                } else {
                    console.log(' Using local college database');
                }
            } catch (error) {
                console.log(' Using local college database (API not available)');
            }
        }

        // AI-powered college search using OpenAI
        async function searchCollegesWithAI(query) {
            if (!isApiEnabled) return [];
            
            try {
                const apiKey = window.getOpenAIApiKey ? window.getOpenAIApiKey() : null;
                if (!apiKey) return [];

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{
                            role: 'system',
                            content: `You are a college search assistant. Given a partial college name, return a JSON array of 10-15 real college/university names that start with or closely match the query. Include both common names and official names. Only return valid, existing institutions. Format: ["College Name 1", "College Name 2", ...]`
                        }, {
                            role: 'user',
                            content: `Find colleges that start with or match: "${query}"`
                        }],
                        max_tokens: 500,
                        temperature: 0.3
                    })
                });

                if (!response.ok) throw new Error('API request failed');
                
                const data = await response.json();
                const aiResults = JSON.parse(data.choices[0].message.content);
                return Array.isArray(aiResults) ? aiResults : [];
            } catch (error) {
                console.log(' AI search failed, using local database:', error.message);
                return [];
            }
        }

        // College Data API integration (using multiple free APIs as fallback)
        async function searchCollegesWithAPI(query) {
            if (apiCache.has(query)) {
                return apiCache.get(query);
            }

            try {
                // Try College Scorecard API first
                const response = await fetch(`https://api.data.gov/ed/collegescorecard/v1/schools?school.name=${encodeURIComponent(query)}&fields=id,school.name&per_page=20&api_key=DEMO_KEY`);
                
                if (response.ok) {
                    const data = await response.json();
                    const apiResults = data.results ? data.results.map(school => school['school.name']).filter(Boolean) : [];
                    
                    if (apiResults.length > 0) {
                        apiCache.set(query, apiResults);
                        return apiResults;
                    }
                }
            } catch (error) {
                console.log('College Scorecard API failed:', error.message);
            }

            try {
                // Fallback to a free college search API
                const response = await fetch(`https://api.collegeai.com/v1/api/college-search?q=${encodeURIComponent(query)}&limit=20`);
                
                if (response.ok) {
                    const data = await response.json();
                    const apiResults = data.colleges ? data.colleges.map(college => college.name).filter(Boolean) : [];
                    
                    if (apiResults.length > 0) {
                        apiCache.set(query, apiResults);
                        return apiResults;
                    }
                }
            } catch (error) {
                console.log('College AI API failed:', error.message);
            }

            // If all APIs fail, return empty array
            apiCache.set(query, []);
            return [];
        }

        // Enhanced college search combining local, API, and AI results
        async function searchColleges(query) {
            const searchIndicator = document.getElementById('searchIndicator');
            
            // Show local results first for immediate feedback
            const localResults = universities.filter(uni => 
                uni.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 3);

            let apiResults = [];
            let aiResults = [];
            let searchSource = 'local';

            // Try AI search first if available
            if (isApiEnabled && query.length >= 3) {
                try {
                    searchIndicator.textContent = ' AI';
                    searchIndicator.className = 'search-indicator ai-powered';
                    aiResults = await searchCollegesWithAI(query);
                    if (aiResults.length > 0) {
                        searchSource = 'ai';
                    }
                } catch (error) {
                    console.log('AI search error:', error);
                }
            }

            // Try API search as fallback
            if (aiResults.length === 0 && query.length >= 3) {
                try {
                    searchIndicator.textContent = ' API';
                    searchIndicator.className = 'search-indicator api-powered';
                    apiResults = await searchCollegesWithAPI(query);
                    if (apiResults.length > 0) {
                        searchSource = 'api';
                    }
                } catch (error) {
                    console.log('API search error:', error);
                }
            }

            // Combine and deduplicate results
            const allResults = [...localResults, ...aiResults, ...apiResults];
            const uniqueResults = [...new Set(allResults)];
            
            // Update search indicator
            if (searchSource === 'ai') {
                searchIndicator.textContent = ' AI';
                searchIndicator.className = 'search-indicator ai-powered';
                searchIndicator.style.display = 'block';
            } else if (searchSource === 'api') {
                searchIndicator.textContent = ' API';
                searchIndicator.className = 'search-indicator api-powered';
                searchIndicator.style.display = 'block';
            } else {
                searchIndicator.textContent = ' Local';
                searchIndicator.className = 'search-indicator';
                searchIndicator.style.display = 'block';
            }
            
            return uniqueResults.slice(0, 8); // Limit to 8 suggestions
        }

        function initializeAutocomplete() {
            const collegeInput = document.getElementById('collegeName');
            const suggestionsDiv = document.getElementById('suggestions');
            const ghostTextDiv = document.getElementById('ghostText');

            if (!collegeInput || !suggestionsDiv || !ghostTextDiv) return;

            collegeInput.addEventListener('input', async function(e) {
                const value = e.target.value.toLowerCase();
                const searchIndicator = document.getElementById('searchIndicator');
                
                if (value.length === 0) {
                    hideSuggestions();
                    hideGhostText();
                    searchIndicator.style.display = 'none';
                    return;
                }

                // Show loading state for longer queries
                if (value.length >= 3) {
                    suggestionsDiv.innerHTML = '<div class="autocomplete-suggestion"> Searching colleges...</div>';
                    suggestionsDiv.style.display = 'block';
                    searchIndicator.style.display = 'block';
                }

                try {
                    // Use enhanced search with AI and API
                    currentSuggestions = await searchColleges(value);

                    if (currentSuggestions.length > 0) {
                        showSuggestions();
                        updateGhostText(value, currentSuggestions[0]);
                    } else {
                        hideSuggestions();
                        hideGhostText();
                        searchIndicator.style.display = 'none';
                    }
                } catch (error) {
                    console.log('Search error:', error);
                    // Fallback to local search
                    currentSuggestions = universities.filter(uni => 
                        uni.toLowerCase().includes(value)
                    ).slice(0, 8);

                    if (currentSuggestions.length > 0) {
                        showSuggestions();
                        updateGhostText(value, currentSuggestions[0]);
                        searchIndicator.textContent = ' Local';
                        searchIndicator.className = 'search-indicator';
                    } else {
                        hideSuggestions();
                        hideGhostText();
                        searchIndicator.style.display = 'none';
                    }
                }
            });

            collegeInput.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    selectedIndex = Math.min(selectedIndex + 1, currentSuggestions.length - 1);
                    updateSelection();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    selectedIndex = Math.max(selectedIndex - 1, -1);
                    updateSelection();
                } else if (e.key === 'Tab' && selectedIndex >= 0) {
                    e.preventDefault();
                    completeSelection();
                } else if (e.key === 'Escape') {
                    hideSuggestions();
                    hideGhostText();
                    selectedIndex = -1;
                }
            });

            collegeInput.addEventListener('blur', function() {
                // Delay hiding to allow clicks on suggestions
                setTimeout(() => {
                    hideSuggestions();
                    hideGhostText();
                }, 200);
            });

            // Handle suggestion clicks
            suggestionsDiv.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-suggestion')) {
                    const suggestion = e.target.textContent;
                    collegeInput.value = suggestion;
                    hideSuggestions();
                    hideGhostText();
                    selectedIndex = -1;
                }
            });
        }

        function showSuggestions() {
            const suggestionsDiv = document.getElementById('suggestions');
            if (!suggestionsDiv) return;

            suggestionsDiv.innerHTML = currentSuggestions.map((suggestion, index) => 
                `<div class="autocomplete-suggestion" data-index="${index}">${suggestion}</div>`
            ).join('');

            suggestionsDiv.style.display = 'block';
            selectedIndex = -1;
        }

        function hideSuggestions() {
            const suggestionsDiv = document.getElementById('suggestions');
            if (suggestionsDiv) {
                suggestionsDiv.style.display = 'none';
            }
        }

        function updateSelection() {
            const suggestions = document.querySelectorAll('.autocomplete-suggestion');
            suggestions.forEach((suggestion, index) => {
                suggestion.classList.toggle('highlighted', index === selectedIndex);
            });

            if (selectedIndex >= 0 && currentSuggestions[selectedIndex]) {
                const collegeInput = document.getElementById('collegeName');
                const value = collegeInput.value.toLowerCase();
                updateGhostText(value, currentSuggestions[selectedIndex]);
            }
        }

        function completeSelection() {
            if (selectedIndex >= 0 && currentSuggestions[selectedIndex]) {
                const collegeInput = document.getElementById('collegeName');
                collegeInput.value = currentSuggestions[selectedIndex];
                hideSuggestions();
                hideGhostText();
                selectedIndex = -1;
            }
        }

        function updateGhostText(inputValue, suggestion) {
            const ghostTextDiv = document.getElementById('ghostText');
            if (!ghostTextDiv) return;

            if (suggestion && suggestion.toLowerCase().startsWith(inputValue.toLowerCase())) {
                const remaining = suggestion.substring(inputValue.length);
                ghostTextDiv.textContent = remaining;
                ghostTextDiv.style.display = 'block';
            } else {
                hideGhostText();
            }
        }

        function hideGhostText() {
            const ghostTextDiv = document.getElementById('ghostText');
            if (ghostTextDiv) {
                ghostTextDiv.style.display = 'none';
            }
        }

        // Initialize autocomplete when the page loads
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize API first
            await initializeCollegeAPI();
            
            // Initialize autocomplete after a short delay to ensure DOM is ready
            setTimeout(initializeAutocomplete, 100);
        });
    </script>
</body>
</html>